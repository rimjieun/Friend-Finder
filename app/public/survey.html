<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Friend Finder</title>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
<body>

  <style>
    select {
      width: 170px !important;
    }
    footer {
      margin: 20px 0;
    }
    button {
      margin-top: 20px;
    }

    .bestmatch {
      float: left;
      margin: 0 20px;
    }

    #bestmatch-list {
      overflow: auto;
    }

  </style>

  <div class="container"> 
    <h1 class="text-center"><strong>Survey Questions</strong></h1><hr>
    <form>
        <div class="user-form">
          <h2><strong>About You</strong></h2>
          <label for="inputdefault"><h4>Name (Required)</h4></label>
          <input class="form-control" id="input-name" type="text">
          <label for="inputdefault"><h4>Link to Photo (Required)</h4></label>
          <input class="form-control input-photo" id="input-photo" type="text">
        </div>
        <hr>
        <div class="survey-form">
          <label for="q1">
            <h2><strong>Question 1</strong></h2>
            <h4>You're alone in your room working on homework and try to toss a paper ball into the bin but miss. You pick up the paper ball, go back to your seat, and keep trying until it goes in.</h4>
          </label>
          <select class="form-control" id="q1">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q2">
            <h2><strong>Question 2</strong></h2>
            <h4>You're driving to meet your friend and running a few minutes late. You have to make a left turn at the next intersection. As you near the traffic light, the light turns yellow and you notice another car is fastly approaching from the other direction with no intent on slowing down. You think you can make the turn before the light turns red and without colliding with the other car, so you make the left turn.</h4>
          </label>
          <select class="form-control" id="q2">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q3">
            <h2><strong>Question 3</strong></h2>
            <h4></h4>
          </label>
          <select class="form-control" id="q3">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q4">
            <h2><strong>Question 4</strong></h2>
          </label>
          <select class="form-control" id="q4">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q5">
            <h2><strong>Question 5</strong></h2>
          </label>
          <select class="form-control" id="q5">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q6">
            <h2><strong>Question 6</strong></h2>
          </label>
          <select class="form-control" id="q6">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q7">
            <h2><strong>Question 7</strong></h2>
          </label>
          <select class="form-control" id="q7">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q8">
            <h2><strong>Question 8</strong></h2>
          </label>
          <select class="form-control" id="q8">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q9">
            <h2><strong>Question 9</strong></h2>
          </label>
          <select class="form-control" id="q9">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
          <label for="q10">
            <h2><strong>Question 10</strong></h2>
          </label>
          <select class="form-control" id="q10">
            <option value="" selected disabled>Please select</option>
            <option data-value="1">1 (Strongly Disagree)</option>
            <option data-value="2">2</option>
            <option data-value="3">3</option>
            <option data-value="4">4</option>
            <option data-value="5">5 (Strongly Agree)</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg" id="submit" data-target="#resultModal">Submit</button>
    </form>
    <hr>
    <footer class="footer">
      <a href="/api/friends">API Friends List</a> |
      <a href="">GitHub Repo</a>
    </footer>
  </div>

  <div class="modal fade" id="resultModal" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Why don't you try being friends with...</h4>
        </div>
        <div class="modal-body">
          <div id="bestmatch-list">
            <!-- best matches go here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  
  <script>

    function isValid(name, url, scoresArr) {

      function is12345(el, ind, arr) {
        return el != undefined;
      }

      if ((name !== "") && (url.match(/\.(jpeg|jpg|gif|png)$/) != null) && (scoresArr.every(is12345) == true)) {
        return true;
      }
      else {
        return false;
      }

    }

    $("#submit").on("click", function(e) {

      e.preventDefault();



      var newFriend = {
        name: $("#input-name").val().trim(),
        photoURL: $("#input-photo").val().trim(),
        scores: []
      };

      $("select > option:selected").each(function() {
        newFriend.scores.push($(this).attr("data-value"));
      });

      if (isValid(newFriend.name, newFriend.photoURL, newFriend.scores)) {
        $.post("/api/new/friend", newFriend, function(data) {

          $("#bestmatch-list").empty();
          
          var bestmatchArr = data;

          if (data.length > 12) {
            bestmatchArr = data.slice(0, 12);
          }
          
          bestmatchArr.map(function(el) {
            var newDiv = $("<div>").addClass("bestmatch");
            var newImg = $("<img>").attr("src", el.photoURL)
                                   .attr("width", "100px")
                                   .attr("height", "100px");
            var newP = $("<p>").text(el.name);
            newDiv.append(newImg).append(newP);

            $("#bestmatch-list").append(newDiv);
          });

        });

        $(this).attr("data-toggle", "modal");
      } else {
        alert("Please make sure to fill out the entire form and that the link to your photo is a valid image URL (.jpeg, .jpg, .gif, .png).");
      }

      

    });
    

  </script>

</body>
</html>